# **公募基金报告自动化采集与分析平台 \- 产品需求文档 (PRD)**

| 文档版本 | 修订日期 | 修订人 | 修订说明 |
| :---- | :---- | :---- | :---- |
| V1.0 | 2025年7月12日 | AI产品经理 | 初始版本创建 |

## **1\. 项目概述**

### **1.1. 项目背景**

公募基金定期报告（季报、半年报、年报）是评估基金投资策略、能力和风险的关键信息来源，其中包含了基金的资产配置、行业分布及重仓股等核心数据。目前，市场上存在以下痛点：

* **手工处理效率低下**：面对数千只基金、长达十多年的海量报告，人工手动下载、查阅和整理数据几乎是不可能完成的任务。  
* **商业数据库成本高昂**：Wind、Choice等专业金融数据终端虽然提供了结构化的基金数据，但其订阅费用高昂，不适合所有研究者或小型机构。  
* **开源数据源的局限性**：部分免费或开源的数据接口（如TuShare）在数据的完整性、及时性和准确性上仍有不足。

基于上传的《如何爬取基金定期报告》文章中的技术思路，本项目旨在开发一个自动化的数据平台，实现对公募基金定期报告的无人值守采集、解析和存储，为投研分析提供及时、准确、低成本的数据支持。

### **1.2. 产品目标**

* **目标一（核心）**：建立一个稳定、高效的自动化流程，实现对中国证监会指定信息披露平台（资本市场电子化信息披露平台）上公募基金定期报告的完整爬取和数据解析。  
* **目标二（数据可用性）**：将报告中的关键信息（资产配置、行业配置、重仓股等）结构化，并存入数据库，方便快速查询、筛选和分析。  
* **目标三（可追溯性）**：保存所有报告的原始文件（XBRL/PDF/HTML格式），确保每一条结构化数据都有据可查，便于人工复核与审计。  
* **目标四（可扩展性）**：系统架构设计应具备良好的扩展性，以应对未来可能增加的数据源、数据维度或分析功能。

### **1.3. 目标用户**

| 用户角色 | 典型场景 |
| :---- | :---- |
| **基金研究员/分析师** | 对特定基金或基金经理的投资组合进行深度分析和跟踪。 |
| **量化策略研究员** | 基于基金持仓数据，开发选股因子、行业轮动等量化模型。 |
| **FOF基金经理** | 批量筛选符合特定投资风格和标准的基金，构建基金组合。 |
| **个人投资者/开发者** | 出于个人研究兴趣，获取并分析基金的详细持仓数据。 |

## **2\. 功能性需求 (Functional Requirements)**

### **2.1. 核心功能模块**

#### **2.1.1. 爬虫与调度模块**

| 需求ID | 需求描述 | 优先级 | 备注 |
| :---- | :---- | :---- | :---- |
| **F-CS-001** | **数据源配置** | 高 | 系统应能配置目标爬取网站的URL。默认数据源为“资本市场电子化信息披露平台 (eid.csrc.gov.cn)”。 |
| **F-CS-002** | **智能任务调度** | 高 | 系统需根据当前日期自动判断并生成待爬取的报告期任务。例如，4月中下旬自动创建第一季度报告的爬取任务；9月上旬自动创建半年报的爬取任务。 |
| **F-CS-003** | **手动任务创建** | 中 | 支持用户手动创建一次性的爬取任务，可指定报告年份（如2023年）和报告类型（如年报），用于历史数据补全。 |
| **F-CS-004** | **分页爬取** | 高 | 爬虫必须能够正确处理目标网站的分页逻辑，通过修改iDisplayStart等请求参数，确保能获取所有符合条件的报告列表。 |
| **F-CS-005** | **原始报告下载** | 高 | 对于列表中的每一份报告，系统必须下载其对应的原始文件（优先下载XBRL格式，若无则下载PDF或HTML），并按统一规范命名（如：基金代码\_报告年份\_报告类型.xbrl）。 |
| **F-CS-006** | **流量控制 (Rate Limit)** | 高 | 必须实现请求频率限制机制，可配置每分钟最大请求数，避免因请求过于频繁而被目标服务器封禁。 |
| **F-CS-007** | **异常处理与重试** | 高 | 爬虫必须能处理网络超时、HTTP错误等常见异常，并内置失败重试机制（如：失败后等待一段时间重试3次）。 |
| **F-CS-008** | **任务日志** | 高 | 详细记录每个爬取任务的执行过程，包括开始时间、结束时间、成功获取的报告数量、失败的报告列表及原因。 |

#### **2.1.2. 数据解析模块**

| 需求ID | 需求描述 | 优先级 | 备注 |
| :---- | :---- | :---- | :---- |
| **F-DP-001** | **XBRL文件解析** | 高 | 系统核心功能。必须能够解析XBRL文件，提取结构化数据。 |
| **F-DP-002** | **关键数据提取** | 高 | 必须从报告中准确提取以下核心字段：\<br\>1. **基本信息**：基金代码、基金简称、报告期、公告日期。\<br\>2. **资产配置**：股票、债券、现金等资产占总资产的比例。\<br\>3. **行业配置**：按证监会行业分类的股票投资组合，及其占基金资产净值的比例。\<br\>4. **前十大重仓股**：股票代码、名称、持股数量、期末公允价值、占基金资产净值比例。 |
| **F-DP-003** | **解析容错** | 高 | 不同基金公司或不同时期的XBRL报告格式可能存在细微差异，解析器需要具备一定的容错能力，不能因单个标签的缺失或变动导致整个文件解析失败。 |
| **F-DP-004** | **解析失败标记** | 中 | 对于无法成功解析的报告文件，系统应进行标记，并记录错误信息，便于人工介入检查。 |

#### **2.1.3. 数据存储模块**

| 需求ID | 需求描述 | 优先级 | 备注 |
| :---- | :---- | :---- | :---- |
| **F-DS-001** | **结构化数据存储** | 高 | 使用关系型数据库（如PostgreSQL, MySQL）存储所有解析出的结构化数据。 |
| **F-DS-002** | **数据库表结构设计** | 高 | 需设计合理的数据库范式，至少包含以下表：\<br\> \- funds (基金信息表)\<br\> \- reports (报告主表)\<br\> \- asset\_allocation (资产配置表)\<br\> \- industry\_allocation (行业配置表)\<br\> \- top\_holdings (前十大重仓股表) \<br\> *详细设计见附录* |
| **F-DS-003** | **原始文件存储** | 高 | 将下载的原始报告文件（XBRL/PDF）存储在服务器指定的文件目录或对象存储（如MinIO, S3）中。 |
| **F-DS-004** | **数据关联** | 高 | 数据库中的每条报告记录都必须包含指向其对应原始文件存储路径的字段，实现数据可追溯。 |
| **F-DS-005** | **数据唯一性** | 高 | 系统需有机制防止同一份报告被重复入库（可通过基金代码+报告期+报告类型作为联合唯一索引）。 |
| **F-DS-006** | **报告更新处理** | 中 | 能够处理基金公司发布的报告修订版或更正公告。可判断公告日期，当发现已存在记录但新公告日期更晚时，进行更新或标记。 |

## **3\. 非功能性需求 (Non-Functional Requirements)**

| 需求类型 | 需求描述 |
| :---- | :---- |
| **性能** | \- **爬取效率**：在合理的流量控制下，系统应能在一夜之内（如8小时）完成单个报告期（如季报）全市场所有基金的爬取和解析任务。\<br\>- **查询性能**：对核心数据表（如重仓股查询）的常用查询，响应时间应在秒级。 |
| **可扩展性** | \- **数据源扩展**：系统架构应易于增加新的数据源（如其他国家或地区的交易所网站）。\<br\>- **数据维度扩展**：数据库和解析模块应易于增加新的提取字段（如债券持仓、完整的股票持仓等）。 |
| **可靠性** | \- **服务稳定性**：系统应能7x24小时稳定运行，单个报告处理失败不应导致整个调度任务中断。\<br\>- **数据准确性**：结构化数据必须与原始报告内容保持100%一致。 |
| **可维护性** | \- **模块化设计**：爬虫、解析、存储等模块应解耦，便于独立开发、测试和维护。\<br\>- **配置化**：所有敏感信息（数据库连接）、可变参数（URL、请求头、流量控制速率）都必须通过配置文件管理，而非硬编码在代码中。 |

## **4\. 附录：数据库表结构初步设计**

1\. funds (基金信息表)  
| 字段名 | 数据类型 | 说明 |  
| :--- | :--- | :--- |  
| fund\_code | VARCHAR(10) | 基金代码 (主键) |  
| fund\_name | VARCHAR(100) | 基金简称 |  
| fund\_full\_name | VARCHAR(255) | 基金全称 |  
| manager\_company | VARCHAR(100) | 基金管理人 |  
| created\_at | TIMESTAMP | 记录创建时间 |  
| updated\_at | TIMESTAMP | 记录更新时间 |  
2\. reports (报告主表)  
| 字段名 | 数据类型 | 说明 |  
| :--- | :--- | :--- |  
| id | BIGINT | 唯一ID (主键) |  
| fund\_code | VARCHAR(10) | 基金代码 (外键) |  
| report\_year | INT | 报告年份 |  
| report\_type | VARCHAR(20) | 报告类型 (e.g., 'Q1', 'Q2', 'Q3', 'SEMI\_ANNUAL', 'ANNUAL') |  
| announcement\_date | DATE | 公告日期 |  
| original\_file\_path| VARCHAR(512) | 原始文件存储路径 |  
| status | VARCHAR(20) | 处理状态 ('DOWNLOADED', 'PARSED', 'FAILED') |  
| created\_at | TIMESTAMP | 记录创建时间 |  
| 联合唯一索引: (fund\_code, report\_year, report\_type) |  
3\. asset\_allocation (资产配置表)  
| 字段名 | 数据类型 | 说明 |  
| :--- | :--- | :--- |  
| id | BIGINT | 唯一ID (主键) |  
| report\_id | BIGINT | 报告ID (外键) |  
| asset\_type | VARCHAR(50) | 资产类别 (如：股票投资, 债券投资, 银行存款和结算备付金合计) |  
| market\_value | DECIMAL(20, 4)| 公允价值 |  
| nav\_percentage | DECIMAL(8, 4\) | 占基金资产净值比例(%) |  
4\. top\_holdings (前十大重仓股表)  
| 字段名 | 数据类型 | 说明 |  
| :--- | :--- | :--- |  
| id | BIGINT | 唯一ID (主键) |  
| report\_id | BIGINT | 报告ID (外键) |  
| stock\_code | VARCHAR(10) | 股票代码 |  
| stock\_name | VARCHAR(50) | 股票名称 |  
| shares\_held | BIGINT | 持股数量 |  
| market\_value | DECIMAL(20, 4)| 期末公允价值 |  
| nav\_percentage | DECIMAL(8, 4\) | 占基金资产净值比例(%) |  
*(注：行业配置等其他表格结构可参照以上设计)*

**文档结束**