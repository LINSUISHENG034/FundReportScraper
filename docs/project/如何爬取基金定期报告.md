---
title: "如何爬取基金定期报告"
source: "https://mp.weixin.qq.com/s/W9PC_eFHYCcTn2iwZ2HLJA"
author:
  - "[[妖精雪风]]"
published:
created: 2025-07-12
description:
tags:
  - "clippings"
---
---
>[!note] Summary
这篇文章介绍了如何爬取基金定期报告的数据，尤其是通过解析XBRL公告。通过爬虫获取报告ID、资产配置、行业配置等信息，并且考虑到流量控制，确保爬虫的高效和可持续性。文中提到，基金公司通过资本市场电子化信息披露平台公开XBRL格式的报告数据，如何批量抓取这些数据，以及如何设置爬虫任务的时间范围，进行合适的报告提取。

>[!note] Key Facts
- 公募基金在定期报告中披露资产配置、行业配置、重仓股等信息。
- XBRL公告可用于提取基金报告的结构化数据。
- 爬虫通过修改GET请求字段，如iDisplayStart、iDisplayLength、reportYear等，获取基金报告的ID。
- 每次任务爬取特定的报告期数据，避免遍历所有历史年份。
- 设置流量控制机制，确保爬虫请求频率合适，避免过度请求服务器。
- 使用RateLimiter来限制请求频率，确保任务的高效执行。
---

原创 妖精雪风 *2025年07月06日 07:00*

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/fpRJcBxZYHqASUjgHWgibuweaqI9l76bibJq17ZpLt38q9FhUJPGBWwvVAeiaGfoIPqiazsK6BEDVicSy3Q1O6ZdiacQ/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1)

> 唉，人哪，此一时彼一时。 过什么河，脱什么鞋。 有多大屁股就穿多大裤衩。 来到了这，我只能自己爬数据了。 过去条件好时候，撸一手正宗的数据库，讲究多了。

## 介绍

公募基金在定期报告中披露资产配置、行业配置、以及重仓股信息，对于基金的评估有重要的作用。手工逐一整理数千只基金、十多年间的报告显然是不现实的；Wind、聚源等商业数据库都已经对这些数据进行了结构化处理，但成本较高；TuShare等免费的数据库虽然也提供了部分基金数据，但数据种类和质量仍存在较多不足。本着自己动手，丰衣足食的原则，我们可以尝试通过爬虫来获取完整的基金报告数据。

## 爬取基金定期报告

## 在哪里找

通常，基金公司在资本市场电子化信息披露平台（ http://eid.csrc.gov.cn/fund/disclose/index.html ）上披露XBRL公告，包括基金募集、定期公告、临时公告等各类信息；XBRL是高度格式化的，可以比较方便的根据标签精确提取我们需要的各类表格或者文本数据。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

## 怎么找？

我们随意点击一个XBRL图标，可以发现浏览器向（http://eid.csrc.gov.cn/fund/disclose/instance\_html\_view.do?instanceid=XXXXXXXX）发出了GET请求，instanceid参数是公告的id。那么问题来了，我们如何能够根据报告期批量获得报告的id呢？

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

仍然打开XBRL的主页面，选择报告类型和报告年度后搜索报告，将向 http://eid.csrc.gov.cn/fund/disclose/advanced\_search\_xbrl.do 地址发送GET请求，默认的请求负载包括具体的查询内容说明（共20个字段）以及时间戳；我们需要修改的字段主要包括以下四个：

| 字段名 | 说明 |
| --- | --- |
| iDisplayStart | 第几页内容 |
| iDisplayLength | 每页展示多少个报告 |
| reportYear | 报告期所属年份 |
| reportTypeCode | 报告类型 |

该请求返回的响应包含报告信息和报告数量两方面内容。报告信息中的uploadInfoId就是我们需要的报告主id。

| 字段名 | 说明 |
| --- | --- |
| uploadInfoId | 公告的id |
| reportYear | 公告所属年度 |
| uploadDate | 公告日 |
| reportSendDate | 公告提交日 |
| reportDesp | 公告描述 |
| fundId | 基金的Id |
| fundCode | 基金代码 |
| fundShortName | 基金简称 |
| organName | 管理公司 |
| classificationCode |  |
| fundSign |  |

同时，响应信息还包括报告的总数量。由于是分页提取，只需对iDisplayStart循环，同时对返回的报告数进行计数，当获得的报告数与总报告数相同时，即提取完毕。

## 具体实现的考虑

## 爬取的时间范围

每次爬取任务都遍历所有的历史年份显然是不必要的。根据规定，基金应于每个季度结束的15个工作日内，披露该季度报告；在每年的8月30日之前披露半年报，在次年的3月31日之前，披露上一年度的年报。可见，我们每次任务执行时，只需根据任务执行日期以及公告披露规则，针对性的提取相应报告期的公告即可。 需要注意的是，有小概率会出现公告内容修改的情况，需要额外的临时补充机制。

## 流量控制

给服务器的请求过于频繁是不人道的，出于可持续爬取的考虑，我们有必要设计流控机制。基金公告爬取任务规模小，单机即足以处理，且非关键任务，我们只需山寨一个轻量级的RateLimiter，即可很好满足需求。 RateLimiter的主要功能是限制在一定预设的间隔之内，能够向一个地址发出的请求次数，并将网络请求的响应通知给发起方。其大致工作流程为，请求方将具体的请求打包成为一个异步任务，托管给RateLimiter进行调度；通过await等待该任务的结果并进行后续的操作。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

发送端的伪代码：

```
StringContent jsonContent = new StringContent(
    JsonSerializer.Serialize(new object[]
    {
        new {name = "sEcho", value = 1},
        new {name = "iDisplayStart", value = cursor},
        new {name = "reportTypeCode", value = ReportType2TypeCode(reportType)},
        new {name = "reportYear", value =  $"{year}"},
        new {name = "iDisplayLength", value = rptsPerQuery}
    }), Encoding.UTF8, "application/json");

string s = await jsonContent.ReadAsStringAsync();
string target = $"{BaseUrl}?aoData={s}&_={timeStamp}";
Task<HttpResponseMessage?> task =
    new Task<HttpResponseMessage?>(() => Fetch(target));
_mRateLimiter.Delegate(task);
var response = await task;
```

在Limiter内部，维护一个Task<HttpResponseMessage?>类型的队列，用作任务的管理；同时用列表记录历史上所有请求的发送时间，以判断是否满足请求发送条件。后面附上伪代码。

```
public class CRateLimiter
{
    ...

    public CRateLimiter(int rate, TimeSpan interval, ILogger<CRateLimiter> logger)
    {
        ...
        _mJobQueue = new Queue<Task<HttpResponseMessage?>>();
        ...
    }

    public bool Delegate(Task<HttpResponseMessage?>task)
    {
        int numOfJobs = 0;
        lock (_mLocker)
        {
            if (!_mIsWorking) returnfalse;
            _mJobQueue.Enqueue(task);
        }
        returntrue;
    }

    private bool Acquire()
    {
        int cnt = GetRequestCnt(DateTime.Now);
        if (cnt < _mRate)
        {
            returntrue;
        }
        returnfalse;
    }
    public void Start()
    {
        ...
    }

    public void Stop()
    {
        ...
    }

    private void WorkerThread()
    {
        while (true)
        {
            int njobs=0;
            lock (_mLocker)
            {
                if (!_mIsWorking && _mJobQueue.Count == 0)
                {
                    break;
                }
                if(_mJobQueue.Count > 0 && Acquire())
                {
                    var job = _mJobQueue.Dequeue();
                    job.Start();
                }
            }
            ...
        }
        _mLogger.LogInformation("The rate limitter is stopped.");
    }
}
```

## 总结

基金公告，尤其是结构化数据的部分，是进行holding based analysis的主要素材。一方面，可以帮助我们更加有效的评估基金的投资能力，另一方面，基金经理，特别是优秀基金经理的行为也是构建个股Alpha的重要素材。

基金中的非结构化部分，例如基金经理的回顾与展望，从历史上看，这部分的内容的干货质量良莠不齐，直接作为文本模型的输入指导投资也许存在一定的不确定性。但是，这部分的文笔还是不错的，用于训练模型作心理按摩是再好不过了，穷则坚守价值，达则积极配置嘛。

  

继续滑动看下一个

雪风的风雪

向上滑动看下一个
