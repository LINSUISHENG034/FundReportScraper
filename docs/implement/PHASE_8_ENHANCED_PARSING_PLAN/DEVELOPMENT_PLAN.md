# 增强型XBRL解析引擎 - 开发计划 (PHASE 8)

## 1. 核心设计思想

为确保新一代XBRL解析引擎的精确性、健壮性与可扩展性，我们将遵循以下核心设计原则：

- **分类标准驱动 (Taxonomy-Driven)**: 优先利用 `reference/XBRL分类标准框架/` 中定义的官方标签体系来精确识别和提取核心财务数据。这是确保数据准确性、一致性和可比性的基石。
- **启发式规则为辅 (Heuristic-Based Fallback)**: 对于分类标准未覆盖、自定义扩展或报告中不规范使用的情况，我们将沿用并增强现有解析器中基于关键词、正则表达式和文档结构的智能抓取方法，作为补充和降级处理机制。
- **分层与解耦 (Layered & Decoupled Architecture)**: 将解析过程清晰地划分为 **“数据源接入 -> 结构化解析 -> 语义映射 -> 数据标准化 -> 验证与输出”** 五个独立的层次。这种设计确保模块高内聚、低耦合，使各组件可独立开发、测试和维护，从而提升整个系统的灵活性和可扩展性。
- **面向接口编程 (Interface-Oriented Design)**: 所有核心组件都将定义清晰的输入输出接口，便于未来替换或升级具体实现，例如引入更高效的XML解析库或集成不同的分类标准版本。

## 2. 总体架构

新解析引擎将由以下核心组件构成，所有新代码将统一存放于 `src/parsers/xbrl/` 目录下，以便于管理。

- **`TaxonomyManager` (分类标准管理器)**: 负责加载、解析和查询XBRL分类标准。
- **`XBRLContext` (XBRL上下文解析器)**: 负责解析XBRL报告中的上下文信息（`context`），如报告实体和期间。
- **`FactExtractor` (事实提取器)**: 负责从报告中提取所有的数据“事实”（Facts）。
- **`StandardizedMapper` (标准化映射器)**: 负责将提取出的原始事实映射到项目统一的 `FundReport` 数据模型。
- **`EnhancedXBRLParser` (新一代XBRL解析器)**: 整合所有组件，编排解析流程，并实现降级处理逻辑。

## 3. 开发阶段规划

我们将分阶段进行开发，确保每个阶段都有明确的目标和可交付的成果。

- **[阶段一：基础建设](./PHASE_1_TASKS.md)**: 搭建新解析引擎的核心骨架，实现对XBRL分类标准和报告上下文的程序化理解能力。
- **阶段二：核心数据点解析**: 实现对财报中关键单值数据点（如资产总计、净利润）的端到端解析。
- **阶段三：复杂表格数据解析**: 实现对投资组合、行业分配等复杂表格数据的解析。
- **阶段四：健壮性与优化**: 实现降级处理逻辑，进行性能优化，并完善文档。

详细的任务列表和验收标准将在每个阶段开始前制定。第一阶段的详细任务请参见 **[阶段一任务列表](./PHASE_1_TASKS.md)**。
